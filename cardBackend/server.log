
> cardbackend@1.0.0 start
> node server.js

Loading DeckManager synchronously...
DeckManager initialized synchronously with 59 total cards
DeckManager already initialized synchronously
Server is running on port 8080
ğŸ”§ Initializing injected game state with proper leader sequence...
   ğŸ¯ Leaders found in zones but not in play sequence - recording leader plays...
ğŸ¯ Recorded PLAY_LEADER: s-1 by playerId_1 in leader (sequence: 1) turn:1 phase:MAIN_PHASE
   âœ… Recorded leader play: s-1 for playerId_1
ğŸ¯ Recorded PLAY_LEADER: s-2 by playerId_2 in leader (sequence: 2) turn:1 phase:MAIN_PHASE
   âœ… Recorded leader play: s-2 for playerId_2
   ğŸ”„ Running unified effect simulation for all plays...
ğŸ¬ Starting unified effect simulation (single source of truth)...
âœ… Initialized fieldEffects structure for all players
ğŸ“‹ Replaying 2 plays directly on gameEnv.players[].fieldEffects...
â–¶ï¸ Executing play 1: PLAY_LEADER s-1 by playerId_1
ğŸ›ï¸ Processing leader s-1 effects for playerId_1 (unified)...
ğŸ”’ Applied zone restrictions to playerId_1: {
  TOP: [ 'å³ç¿¼', 'è‡ªç”±', 'ç¶“æ¿Ÿ' ],
  LEFT: [ 'å³ç¿¼', 'è‡ªç”±', 'æ„›åœ‹è€…' ],
  RIGHT: [ 'å³ç¿¼', 'æ„›åœ‹è€…', 'ç¶“æ¿Ÿ' ],
  HELP: [ 'ALL' ],
  SP: [ 'ALL' ]
}
ğŸ”„ Converting old effect format for leader s-1...
ğŸ”„ Converted old effect: powerBoost +45 for types: å³ç¿¼, æ„›åœ‹è€…
ğŸ”„ Converted old effect: setPower +0 for types: ç¶“æ¿Ÿ
âœ… Leader s-1 effects applied to unified structure
ğŸ­ Processing card effects for s-1 (unified)
âš¡ Checking triggered effects for s-1 (unified)
â–¶ï¸ Executing play 2: PLAY_LEADER s-2 by playerId_2
ğŸ›ï¸ Processing leader s-2 effects for playerId_2 (unified)...
ğŸ”’ Applied zone restrictions to playerId_2: {
  TOP: [ 'å·¦ç¿¼', 'è‡ªç”±', 'ç¶“æ¿Ÿ', 'å³ç¿¼', 'æ„›åœ‹è€…' ],
  LEFT: [ 'å·¦ç¿¼', 'è‡ªç”±', 'ç¶“æ¿Ÿ', 'å³ç¿¼', 'æ„›åœ‹è€…' ],
  RIGHT: [ 'å·¦ç¿¼', 'è‡ªç”±', 'ç¶“æ¿Ÿ', 'å³ç¿¼', 'æ„›åœ‹è€…' ],
  HELP: [ 'ALL' ],
  SP: [ 'ALL' ]
}
ğŸ”„ Converting old effect format for leader s-2...
ğŸ”„ Converted old effect: powerBoost +40 for types: 
âœ… Leader s-2 effects applied to unified structure
ğŸ­ Processing card effects for s-2 (unified)
âš¡ Checking triggered effects for s-2 (unified)
ğŸ”¢ Calculating final power values (unified)...
ğŸ“ˆ Applied power boost +45 to c-1: 100 â†’ 145
âœ… Final power calculation completed (unified)
âœ… Unified simulation completed - all effects available in gameEnv.players[].fieldEffects
   âœ… Unified effect simulation completed - all effects in gameEnv.players[].fieldEffects
DEBUG: Processing action for playerId_2 in game debug_h2_play_test: PlayCard
DEBUG: Game data loaded successfully
DEBUG: About to call checkIsPlayOkForAction
hand ["h-2"]
DEBUG: checkIsPlayOkForAction result: true
DEBUG: About to call processAction
DEBUG: About to get card details for: h-2
DEBUG: Card details received: {
  id: 'h-2',
  name: 'Make America Great Again',
  cardType: 'help',
  effects: { description: 'é¸æ“‡å°æ–¹ä¸€å¼µè§’è‰²å¡ï¼ŒåŸèƒ½åŠ›å€¼ è®Šæˆ 0', rules: [ [Object] ] }
}
DEBUG: Checking 0 help cards for player playerId_2
Invalid card structure in left zone: {
  id: 'c-1',
  name: 'ç¸½çµ±ç‰¹æœ—æ™®',
  cardType: 'character',
  gameType: 'æ„›åœ‹è€…',
  power: 100,
  traits: [ 'ç‰¹æœ—æ™®å®¶æ—' ]
}
ERROR in processPlayerAction: Cannot read properties of undefined (reading '0')
Stack trace: TypeError: Cannot read properties of undefined (reading '0')
    at mozGamePlay.checkIsSummonBattleReady (/Users/hello/Desktop/card/unity/cardGameRevamp/cardBackend/src/mozGame/mozGamePlay.js:817:58)
    at mozGamePlay.checkIsMainPhaseComplete (/Users/hello/Desktop/card/unity/cardGameRevamp/cardBackend/src/mozGame/mozGamePlay.js:863:51)
    at mozGamePlay.processAction (/Users/hello/Desktop/card/unity/cardGameRevamp/cardBackend/src/mozGame/mozGamePlay.js:594:52)
    at async GameLogic.processPlayerAction (/Users/hello/Desktop/card/unity/cardGameRevamp/cardBackend/src/services/GameLogic.js:295:34)
    at async playerAction (/Users/hello/Desktop/card/unity/cardGameRevamp/cardBackend/src/controllers/gameController.js:43:31)
ğŸ”§ Initializing injected game state with proper leader sequence...
   ğŸ¯ Leaders found in zones but not in play sequence - recording leader plays...
ğŸ¯ Recorded PLAY_LEADER: s-1 by playerId_1 in leader (sequence: 1) turn:1 phase:MAIN_PHASE
   âœ… Recorded leader play: s-1 for playerId_1
ğŸ¯ Recorded PLAY_LEADER: s-2 by playerId_2 in leader (sequence: 2) turn:1 phase:MAIN_PHASE
   âœ… Recorded leader play: s-2 for playerId_2
   ğŸ”„ Running unified effect simulation for all plays...
ğŸ¬ Starting unified effect simulation (single source of truth)...
âœ… Initialized fieldEffects structure for all players
ğŸ“‹ Replaying 2 plays directly on gameEnv.players[].fieldEffects...
â–¶ï¸ Executing play 1: PLAY_LEADER s-1 by playerId_1
ğŸ›ï¸ Processing leader s-1 effects for playerId_1 (unified)...
ğŸ”’ Applied zone restrictions to playerId_1: {
  TOP: [ 'å³ç¿¼', 'è‡ªç”±', 'ç¶“æ¿Ÿ' ],
  LEFT: [ 'å³ç¿¼', 'è‡ªç”±', 'æ„›åœ‹è€…' ],
  RIGHT: [ 'å³ç¿¼', 'æ„›åœ‹è€…', 'ç¶“æ¿Ÿ' ],
  HELP: [ 'ALL' ],
  SP: [ 'ALL' ]
}
ğŸ”„ Converting old effect format for leader s-1...
ğŸ”„ Converted old effect: powerBoost +45 for types: å³ç¿¼, æ„›åœ‹è€…
ğŸ”„ Converted old effect: setPower +0 for types: ç¶“æ¿Ÿ
âœ… Leader s-1 effects applied to unified structure
ğŸ­ Processing card effects for s-1 (unified)
âš¡ Checking triggered effects for s-1 (unified)
â–¶ï¸ Executing play 2: PLAY_LEADER s-2 by playerId_2
ğŸ›ï¸ Processing leader s-2 effects for playerId_2 (unified)...
ğŸ”’ Applied zone restrictions to playerId_2: {
  TOP: [ 'å·¦ç¿¼', 'è‡ªç”±', 'ç¶“æ¿Ÿ', 'å³ç¿¼', 'æ„›åœ‹è€…' ],
  LEFT: [ 'å·¦ç¿¼', 'è‡ªç”±', 'ç¶“æ¿Ÿ', 'å³ç¿¼', 'æ„›åœ‹è€…' ],
  RIGHT: [ 'å·¦ç¿¼', 'è‡ªç”±', 'ç¶“æ¿Ÿ', 'å³ç¿¼', 'æ„›åœ‹è€…' ],
  HELP: [ 'ALL' ],
  SP: [ 'ALL' ]
}
ğŸ”„ Converting old effect format for leader s-2...
ğŸ”„ Converted old effect: powerBoost +40 for types: 
âœ… Leader s-2 effects applied to unified structure
ğŸ­ Processing card effects for s-2 (unified)
âš¡ Checking triggered effects for s-2 (unified)
ğŸ”¢ Calculating final power values (unified)...
ğŸ“ˆ Applied power boost +45 to c-1: 100 â†’ 145
âœ… Final power calculation completed (unified)
âœ… Unified simulation completed - all effects available in gameEnv.players[].fieldEffects
   âœ… Unified effect simulation completed - all effects in gameEnv.players[].fieldEffects
DEBUG: Processing action for playerId_2 in game debug_h2_play_test: PlayCard
DEBUG: Game data loaded successfully
DEBUG: About to call checkIsPlayOkForAction
hand ["h-2"]
DEBUG: checkIsPlayOkForAction result: true
DEBUG: About to call processAction
DEBUG: About to get card details for: h-2
DEBUG: Card details received: {
  id: 'h-2',
  name: 'Make America Great Again',
  cardType: 'help',
  effects: { description: 'é¸æ“‡å°æ–¹ä¸€å¼µè§’è‰²å¡ï¼ŒåŸèƒ½åŠ›å€¼ è®Šæˆ 0', rules: [ [Object] ] }
}
DEBUG: Checking 0 help cards for player playerId_2
Invalid card structure in left zone: {
  id: 'c-1',
  name: 'ç¸½çµ±ç‰¹æœ—æ™®',
  cardType: 'character',
  gameType: 'æ„›åœ‹è€…',
  power: 100,
  traits: [ 'ç‰¹æœ—æ™®å®¶æ—' ]
}
ERROR in processPlayerAction: Cannot read properties of undefined (reading '0')
Stack trace: TypeError: Cannot read properties of undefined (reading '0')
    at mozGamePlay.checkIsSummonBattleReady (/Users/hello/Desktop/card/unity/cardGameRevamp/cardBackend/src/mozGame/mozGamePlay.js:817:58)
    at mozGamePlay.checkIsMainPhaseComplete (/Users/hello/Desktop/card/unity/cardGameRevamp/cardBackend/src/mozGame/mozGamePlay.js:863:51)
    at mozGamePlay.processAction (/Users/hello/Desktop/card/unity/cardGameRevamp/cardBackend/src/mozGame/mozGamePlay.js:594:52)
    at async GameLogic.processPlayerAction (/Users/hello/Desktop/card/unity/cardGameRevamp/cardBackend/src/services/GameLogic.js:295:34)
    at async playerAction (/Users/hello/Desktop/card/unity/cardGameRevamp/cardBackend/src/controllers/gameController.js:43:31)
