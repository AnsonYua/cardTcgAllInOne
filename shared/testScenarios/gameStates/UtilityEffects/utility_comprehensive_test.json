{
  "gameId": "utility_comprehensive_test_fixed",
  "description": "Comprehensive test for utility card effects including neutralization, zone freedom, and immunity",
  "testType": "dynamic",
  "initialGameEnv": {
    "phase": "MAIN_PHASE",
    "round": 1,
    "gameStarted": true,
    "currentPlayer": "playerId_1",
    "currentTurn": 0,
    "firstPlayer": 0,
    "players": {
      "playerId_1": {
        "id": "playerId_1",
        "name": "Player 1",
        "deck": {
          "hand": ["h-5", "c-1", "c-2", "c-3", "sp-1"],
          "mainDeck": ["c-4", "c-5", "c-6", "c-7", "c-8", "c-9", "c-10", "c-11", "c-12", "c-13", "c-14", "c-15", "h-1", "h-2", "h-3", "h-4", "sp-2", "sp-3"],
          "leader": ["s-1", "s-2", "s-3", "s-4"],
          "currentLeaderIdx": 0
        },
        "isReady": true,
        "redraw": 1,
        "turnAction": [],
        "playerPoint": 0
      },
      "playerId_2": {
        "id": "playerId_2",
        "name": "Player 2",
        "deck": {
          "hand": ["h-1", "h-2", "c-21", "c-22", "c-23"],
          "mainDeck": ["c-24", "c-25", "c-26", "c-27", "c-28", "c-1", "c-2", "c-3", "c-4", "c-5", "c-6", "c-7", "h-8", "h-12", "sp-8", "sp-9", "sp-1", "sp-2"],
          "leader": ["s-6", "s-2", "s-3", "s-4"],
          "currentLeaderIdx": 0
        },
        "isReady": true,
        "redraw": 1,
        "turnAction": [],
        "playerPoint": 0
      }
    },
    "zones": {
      "playerId_1": {
        "leader": {
          "id": "s-1",
          "name": "特朗普",
          "cardType": "leader",
          "gameType": "愛國者",
          "initialPoint": 100,
          "level": 6,
          "rarity": "legendary",
          "zoneCompatibility": {
            "top": ["右翼", "自由", "經濟"],
            "left": ["右翼", "自由", "愛國者"],
            "right": ["右翼", "愛國者", "經濟"]
          },
          "effects": {
            "description": "我方場上右翼或愛國者類型的角色卡 原能力值加 +45",
            "rules": [
              {
                "id": "trump_power_boost",
                "type": "continuous",
                "trigger": {
                  "event": "always",
                  "conditions": []
                },
                "target": {
                  "owner": "self",
                  "zones": ["top", "left", "right"],
                  "filters": [
                    {
                      "type": "gameTypeOr",
                      "values": ["右翼", "愛國者"]
                    }
                  ]
                },
                "effect": {
                  "type": "powerBoost",
                  "value": 45
                }
              }
            ]
          }
        },
        "top": [],
        "left": [],
        "right": [],
        "help": [],
        "sp": []
      },
      "playerId_2": {
        "leader": {
          "id": "s-6",
          "name": "馬斯克",
          "cardType": "leader",
          "gameType": "經濟",
          "initialPoint": 95,
          "level": 5,
          "rarity": "legendary",
          "zoneCompatibility": {
            "top": ["經濟", "自由", "左翼"],
            "left": ["經濟", "自由", "右翼"],
            "right": ["經濟", "右翼", "左翼"]
          },
          "effects": {
            "description": "我方場上經濟類型的角色卡 原能力值加 +35",
            "rules": [
              {
                "id": "musk_economy_boost",
                "type": "continuous",
                "trigger": {
                  "event": "always",
                  "conditions": []
                },
                "target": {
                  "owner": "self",
                  "zones": ["top", "left", "right"],
                  "filters": [
                    {
                      "type": "gameType",
                      "value": "經濟"
                    }
                  ]
                },
                "effect": {
                  "type": "powerBoost",
                  "value": 35
                }
              }
            ]
          }
        },
        "top": [],
        "left": [],
        "right": [],
        "help": [],
        "sp": []
      }
    },
    "gameEvents": [],
    "lastEventId": 1,
    "pendingPlayerAction": null,
    "pendingCardSelections": {},
    "playSequence": {
      "globalSequence": 0,
      "plays": []
    }
  },
  "playerActions": [
    {
      "step": 1,
      "description": "Player 1 attempts to place c-1 (特朗普) in TOP zone - should fail due to zone restriction",
      "playerId": "playerId_1",
      "action": {
        "actionType": "PlayCard",
        "cardId": "c-1",
        "zone": "top"
      },
      "expectedResult": {
        "success": false,
        "error": "ZONE_COMPATIBILITY_ERROR"
      },
      "expectedStateChanges": {
        "currentPlayer": "playerId_1",
        "currentTurn": 0,
        "turnNotAdvanced": true
      }
    },
    {
      "step": 2,
      "description": "Player 1 places h-5 (失智老人) in HELP zone - grants zone freedom and power boost with immunity",
      "playerId": "playerId_1",
      "action": {
        "actionType": "PlayCard",
        "cardId": "h-5",
        "zone": "help"
      },
      "expectedResult": {
        "success": true,
        "noError": true,
        "cardPlaced": true
      },
      "expectedEffects": [
        "h-5 grants zonePlacementFreedom to player 1",
        "h-5 grants +20 power boost to all player 1 cards",
        "h-5 has immuneToNeutralization protection"
      ],
      "expectedStateChanges": {
        "currentPlayer": "playerId_2",
        "currentTurn": 1,
        "turnSwitched": true,
        "zones.playerId_1.help.length": 1
      }
    },
    {
      "step": 3,
      "description": "Player 2 places h-2 (Make America Great Again) in HELP zone - provides targetCount effect",
      "playerId": "playerId_2",
      "action": {
        "actionType": "PlayCard",
        "cardId": "h-2",
        "zone": "help"
      },
      "expectedResult": {
        "success": true,
        "noError": true,
        "cardPlaced": true
      },
      "expectedEffects": [
        "h-2 provides automatic target selection (targetCount: 1)",
        "h-2 will target first opponent character when placed"
      ],
      "expectedStateChanges": {
        "currentPlayer": "playerId_1",
        "currentTurn": 2,
        "turnSwitched": true,
        "zones.playerId_2.help.length": 1
      }
    },
    {
      "step": 4,
      "description": "Player 1 places c-1 (特朗普) in TOP zone - should now succeed due to zone freedom",
      "playerId": "playerId_1",
      "action": {
        "actionType": "PlayCard",
        "cardId": "c-1",
        "zone": "top"
      },
      "expectedResult": {
        "success": true,
        "noError": true,
        "cardPlaced": true
      },
      "expectedEffects": [
        "c-1 placed despite zone restriction due to h-5 zone freedom",
        "c-1 receives +45 power from Trump leader (愛國者 type)",
        "c-1 receives +20 power from h-5 (immune to neutralization)",
        "c-1 provides +10 trait boost to other 特朗普家族 cards"
      ],
      "expectedStateChanges": {
        "currentPlayer": "playerId_2",
        "currentTurn": 3,
        "turnSwitched": true,
        "zones.playerId_1.top.length": 1
      }
    },
    {
      "step": 5,
      "description": "Player 2 places h-1 (Deep State) in HELP zone - should find no eligible targets due to h-5 immunity",
      "playerId": "playerId_2",
      "action": {
        "actionType": "PlayCard",
        "cardId": "h-1",
        "zone": "help"
      },
      "expectedResult": {
        "success": true,
        "noError": true,
        "cardPlaced": true,
        "requiresSelection": false
      },
      "expectedEffects": [
        "h-1 attempts to find neutralization targets",
        "h-5 is immune and cannot be selected",
        "h-2 can be neutralized",
        "h-1 should trigger selection for h-2"
      ],
      "expectedStateChanges": {
        "currentPlayer": "playerId_2",
        "currentTurn": 4,
        "turnNotSwitched": true,
        "zones.playerId_2.help.length": 2,
        "pendingPlayerAction": "CARD_SELECTION",
        "pendingCardSelectionsCount": 1
      }
    },
    {
      "step": 5.5,
      "description": "Player 2 completes card selection - selects h-2 to neutralize (h-5 is immune)",
      "playerId": "playerId_2",
      "action": {
        "actionType": "SelectCard",
        "cardIds": ["h-2"]
      },
      "expectedResult": {
        "success": true,
        "noError": true,
        "selectionCompleted": true
      },
      "expectedEffects": [
        "h-2 (Make America Great Again) neutralized by h-1 selection",
        "h-5 remains fully active due to immunity",
        "Only h-2 is neutralized, h-5 effects continue"
      ],
      "expectedStateChanges": {
        "currentPlayer": "playerId_1",
        "currentTurn": 5,
        "turnSwitched": true,
        "pendingPlayerAction": null,
        "pendingCardSelections": {}
      }
    },
    {
      "step": 6,
      "description": "Player 1 places additional character cards to test continued zone freedom",
      "playerId": "playerId_1",
      "action": {
        "actionType": "PlayCard",
        "cardId": "c-2",
        "zone": "left"
      },
      "expectedResult": {
        "success": true,
        "noError": true,
        "cardPlaced": true
      },
      "expectedEffects": [
        "c-2 placed successfully due to h-5 zone freedom (still active)",
        "c-2 receives +20 power from h-5 (immune to neutralization)",
        "Zone freedom proves immunity is working"
      ],
      "expectedStateChanges": {
        "currentPlayer": "playerId_2",
        "currentTurn": 6,
        "turnSwitched": true,
        "zones.playerId_1.left.length": 1
      }
    },
    {
      "step": 7,
      "description": "Player 2 places c-21 (奧巴馬) in TOP zone",
      "playerId": "playerId_2",
      "action": {
        "actionType": "PlayCard",
        "cardId": "c-21",
        "zone": "top"
      },
      "expectedResult": {
        "success": true,
        "noError": true,
        "cardPlaced": true
      },
      "expectedEffects": [
        "c-21 provides +50 single target boost to first opponent character (c-1)",
        "c-21 receives leader boost from Musk"
      ],
      "expectedStateChanges": {
        "currentPlayer": "playerId_1",
        "currentTurn": 7,
        "turnSwitched": true,
        "zones.playerId_2.top.length": 1
      }
    },
    {
      "step": 8,
      "description": "Player 1 fills final character zone",
      "playerId": "playerId_1",
      "action": {
        "actionType": "PlayCard",
        "cardId": "c-3",
        "zone": "right"
      },
      "expectedResult": {
        "success": true,
        "noError": true,
        "cardPlaced": true
      },
      "expectedStateChanges": {
        "currentPlayer": "playerId_2",
        "currentTurn": 8,
        "turnSwitched": true,
        "zones.playerId_1.right.length": 1
      }
    },
    {
      "step": 9,
      "description": "Player 2 fills final character zone",
      "playerId": "playerId_2",
      "action": {
        "actionType": "PlayCard",
        "cardId": "c-22",
        "zone": "left"
      },
      "expectedResult": {
        "success": true,
        "noError": true,
        "cardPlaced": true
      },
      "expectedStateChanges": {
        "currentPlayer": "playerId_1",
        "currentTurn": 9,
        "turnSwitched": true,
        "zones.playerId_2.left.length": 1
      }
    },
    {
      "step": 10,
      "description": "Player 1 places final character",
      "playerId": "playerId_1",
      "action": {
        "actionType": "PlayCard",
        "cardId": "sp-1",
        "zone": "right"
      },
      "expectedResult": {
        "success": true,
        "noError": true,
        "cardPlaced": true
      },
      "expectedStateChanges": {
        "currentPlayer": "playerId_2",
        "currentTurn": 10,
        "turnSwitched": true,
        "zones.playerId_1.right.length": 2,
        "mainPhaseComplete": true,
        "advanceToSPPhase": true
      }
    }
  ],
  "expectedStateChanges": {
    "zones.playerId_1.help.length": 1,
    "zones.playerId_1.top.length": 1,
    "zones.playerId_1.left.length": 1,
    "zones.playerId_1.right.length": 2,
    "zones.playerId_2.help.length": 2,
    "zones.playerId_2.top.length": 1,
    "zones.playerId_2.left.length": 1,
    "zones.playerId_2.right.length": 0,
    "players.playerId_1.deck.hand.length": 0,
    "players.playerId_2.deck.hand.length": 1,
    "playSequence.plays.length": 10,
    "phase": "SP_PHASE",
    "currentTurn": 10
  },
  "validationPoints": {
    "immunity_validation": {
      "description": "Test that h-5 immunity prevents neutralization completely",
      "expected": {
        "h5ZoneFreedomActive": true,
        "h5PowerBoostActive": true,
        "h5CannotBeNeutralized": true,
        "h2CanBeNeutralized": true
      }
    },
    "zone_freedom_validation": {
      "description": "Test that zone freedom allows unrestricted card placement",
      "expected": {
        "c1CanPlaceInTopDespiteRestriction": true,
        "c2CanPlaceInLeftDespiteRestriction": true,
        "zoneFreedomRemainsAfterNeutralizationAttempt": true
      }
    },
    "power_calculation_validation": {
      "description": "Test power calculations with active vs neutralized effects",
      "expected": {
        "c1FinalPower": 175,
        "c2FinalPower": 85,
        "c21FinalPower": 165
      },
      "powerBreakdown": {
        "c1": {
          "basePower": 100,
          "trumpLeaderBoost": 45,
          "h5PowerBoost": 20,
          "characterSelfBoost": 10,
          "total": 175,
          "note": "h-5 boost remains active due to immunity"
        },
        "c2": {
          "basePower": 65,
          "h5PowerBoost": 20,
          "total": 85,
          "note": "h-5 boost remains active due to immunity"
        },
        "c21": {
          "basePower": 80,
          "muskLeaderBoost": 35,
          "obamaTargetBoost": 50,
          "total": 165,
          "note": "Obama targets c-1 with +50 boost"
        }
      }
    }
  },
  "cardDefinitions": {
    "h-1": {
      "name": "Deep State",
      "cardType": "help",
      "effects": {
        "description": "選擇對方場上的一張SP卡或HELP卡，該卡效果變為無效。",
        "rules": [
          {
            "id": "deep_state_neutralize",
            "type": "triggered",
            "trigger": {
              "event": "onPlay",
              "conditions": []
            },
            "target": {
              "owner": "opponent",
              "zones": ["help", "sp"],
              "filters": [],
              "requiresSelection": true,
              "selectCount": 1
            },
            "effect": {
              "type": "neutralizeEffect",
              "value": true
            }
          }
        ]
      }
    },
    "h-2": {
      "name": "Make America Great Again",
      "cardType": "help",
      "effects": {
        "description": "對方一張角色卡，原能力值 變成 0",
        "rules": [
          {
            "id": "maga_nerf",
            "type": "continuous",
            "trigger": {
              "event": "always",
              "conditions": []
            },
            "target": {
              "owner": "opponent",
              "zones": ["top", "left", "right"],
              "targetCount": 1,
              "filters": []
            },
            "effect": {
              "type": "setPower",
              "value": 0
            }
          }
        ]
      }
    },
    "h-5": {
      "name": "失智老人",
      "cardType": "help",
      "effects": {
        "description": "可在上，左，右區域打出任可屬於的角色卡。而且全部召喚出來的角色能力值再 +20. 這張卡的效果不能被無效文化 。",
        "rules": [
          {
            "id": "dementia_placement_freedom",
            "type": "continuous",
            "trigger": {
              "event": "always",
              "conditions": []
            },
            "target": {
              "owner": "self",
              "zones": ["top", "left", "right"],
              "filters": []
            },
            "effect": {
              "type": "zonePlacementFreedom",
              "value": true
            }
          },
          {
            "id": "dementia_power_boost",
            "type": "continuous",
            "trigger": {
              "event": "always",
              "conditions": []
            },
            "target": {
              "owner": "self",
              "zones": ["top", "left", "right"],
              "filters": []
            },
            "effect": {
              "type": "powerBoost",
              "value": 20
            }
          }
        ],
        "immuneToNeutralization": true
      }
    }
  }
}