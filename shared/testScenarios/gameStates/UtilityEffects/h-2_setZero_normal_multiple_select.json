{
  "description": "h-2 Make America Great Again - setPower effect validation with real game state",
  "gameId": "h2_setpower_validation",
  "testType": "utility_effect",
  "category": "setPower",
  "tags": ["h-2", "MAGA", "setPower", "cross-player", "card-selection", "validation"],
  "initialGameEnv": {
    "phase": "MAIN_PHASE",
    "round": 1,
    "gameStarted": true,
    "currentPlayer": "playerId_2",
    "currentTurn": 1,
    "firstPlayer": 0,
    "players": {
      "playerId_1": {
        "id": "playerId_1",
        "name": "Player 1",
        "deck": {
          "hand": ["h-1", "c-2", "c-3", "c-4"],
          "mainDeck": [
            "c-5", "c-6", "c-7", "c-8", "c-9", "c-10",
            "c-11", "c-12", "c-13", "c-14", "c-15", "c-16",
            "h-3", "h-4", "sp-1", "sp-2", "sp-3"
          ],
          "leader": ["s-1", "s-2", "s-3", "s-4"],
          "currentLeaderIdx": 0
        },
        "isReady": true,
        "redraw": 1,
        "turnAction": [
          {
            "type": "PlayCard",
            "card_idx": 0,
            "field_idx": 1,
            "selectedCard": {
              "card": ["c-1"],
              "cardDetails": [
                {
                  "id": "c-1",
                  "name": "總統特朗普",
                  "cardType": "character",
                  "gameType": "愛國者",
                  "power": 100,
                  "traits": ["特朗普家族"],
                  "rarity": "legendary"
                }
              ],
              "isBack": [false],
              "valueOnField": 155
            },
            "turn": 0
          }
        ],
        "playerPoint": 155,
        "fieldEffects": {
          "zoneRestrictions": {
            "TOP": ["右翼", "自由", "經濟"],
            "LEFT": ["右翼", "自由", "愛國者"],
            "RIGHT": ["右翼", "愛國者", "經濟"],
            "HELP": ["ALL"],
            "SP": ["ALL"]
          },
          "activeEffects": [
            {
              "effectId": "s-1_powerBoost",
              "source": "s-1",
              "sourcePlayerId": "playerId_1",
              "type": "powerBoost",
              "target": {
                "scope": "SELF",
                "zones": ["top", "left", "right"],
                "gameTypes": ["右翼", "愛國者"]
              },
              "value": 45,
              "priority": 0,
              "unremovable": false
            },
            {
              "effectId": "s-1_setPower",
              "source": "s-1",
              "sourcePlayerId": "playerId_1",
              "type": "setPower",
              "target": {
                "scope": "SELF",
                "zones": ["top", "left", "right"],
                "gameTypes": ["經濟"]
              },
              "value": 0,
              "priority": 0,
              "unremovable": false
            },
            {
              "effectId": "c-1_trump_president_boost",
              "source": "c-1",
              "sourcePlayerId": "playerId_1",
              "type": "powerBoost",
              "target": {
                "scope": "SELF",
                "zones": ["top", "left", "right"],
                "gameTypes": [],
                "traits": ["特朗普家族"]
              },
              "value": 10,
              "priority": 0,
              "unremovable": false
            }
          ],
          "specialEffects": {},
          "calculatedPowers": {
            "c-1": 155
          },
          "disabledCards": [],
          "victoryPointModifiers": 0
        }
      },
      "playerId_2": {
        "id": "playerId_2",
        "name": "Player 2",
        "deck": {
          "hand": ["c-17", "c-18", "c-19", "c-20", "c-21"],
          "mainDeck": [
            "c-22", "c-23", "c-24", "c-25", "c-26", "c-27",
            "c-28", "c-29", "c-30", "c-31", "c-32", "c-33",
            "h-5", "h-6", "h-7", "sp-4", "sp-5", "sp-6"
          ],
          "leader": ["s-2", "s-3", "s-4", "s-5"],
          "currentLeaderIdx": 0
        },
        "isReady": true,
        "redraw": 1,
        "turnAction": [
          {
            "type": "PlayCard",
            "card_idx": 0,
            "field_idx": 3,
            "selectedCard": {
              "card": ["h-2"],
              "cardDetails": [
                {
                  "id": "h-2",
                  "name": "Make America Great Again",
                  "cardType": "help"
                }
              ],
              "isBack": [false],
              "valueOnField": 40
            },
            "turn": 1
          }
        ],
        "playerPoint": 0,
        "fieldEffects": {
          "zoneRestrictions": {
            "TOP": ["左翼", "自由", "經濟", "右翼", "愛國者"],
            "LEFT": ["左翼", "自由", "經濟", "右翼", "愛國者"],
            "RIGHT": ["左翼", "自由", "經濟", "右翼", "愛國者"],
            "HELP": ["ALL"],
            "SP": ["ALL"]
          },
          "activeEffects": [
            {
              "effectId": "s-2_powerBoost",
              "source": "s-2",
              "sourcePlayerId": "playerId_2",
              "type": "powerBoost",
              "target": {
                "scope": "SELF",
                "zones": ["top", "left", "right"]
              },
              "value": 40,
              "priority": 0,
              "unremovable": false
            }
          ],
          "specialEffects": {},
          "calculatedPowers": {
            "h-2": 40
          },
          "disabledCards": [],
          "victoryPointModifiers": 0
        }
      }
    },
    "zones": {
      "playerId_1": {
        "leader": {
          "id": "s-1",
          "name": "特朗普",
          "cardType": "leader",
          "gameType": "右翼",
          "initialPoint": 110,
          "level": 7,
          "rarity": "legendary",
          "zoneCompatibility": {
            "top": ["右翼", "自由", "經濟"],
            "left": ["右翼", "自由", "愛國者"],
            "right": ["右翼", "愛國者", "經濟"]
          }
        },
        "top": [],
        "left": [
          {
            "card": ["c-1"],
            "cardDetails": [
              {
                "id": "c-1",
                "name": "總統特朗普",
                "cardType": "character",
                "gameType": "愛國者",
                "power": 100,
                "traits": ["特朗普家族"],
                "rarity": "legendary"
              }
            ],
            "isBack": [false],
            "valueOnField": 155
          }
        ],
        "right": [],
        "help": [],
        "sp": []
      },
      "playerId_2": {
        "leader": {
          "id": "s-2",
          "name": "拜登",
          "cardType": "leader",
          "gameType": "左翼",
          "initialPoint": 100,
          "level": 7,
          "rarity": "legendary",
          "zoneCompatibility": {
            "top": ["左翼", "自由", "經濟", "右翼", "愛國者"],
            "left": ["左翼", "自由", "經濟", "右翼", "愛國者"],
            "right": ["左翼", "自由", "經濟", "右翼", "愛國者"]
          }
        },
        "top": [],
        "left": [],
        "right": [],
        "help": [
          {
            "card": ["h-2"],
            "cardDetails": [
              {
                "id": "h-2",
                "name": "Make America Great Again",
                "cardType": "help"
              }
            ],
            "isBack": [false],
            "valueOnField": 40
          }
        ],
        "sp": []
      }
    },
    "gameEvents": [
      {
        "id": "event_1753090836037_card_selection",
        "type": "CARD_SELECTION_REQUIRED",
        "data": {
          "playerId": "playerId_2",
          "selectionId": "playerId_2_setPower_1753090836037",
          "eligibleCardCount": 1,
          "selectCount": 1,
          "effectType": "setPower"
        },
        "timestamp": 1753090836037,
        "expiresAt": 1753090839037,
        "frontendProcessed": false
      }
    ],
    "lastEventId": 11,
    "pendingPlayerAction": {
      "type": "cardSelection",
      "selectionId": "playerId_2_setPower_1753090836037",
      "description": "Select 1 opponent character card(s) to set power to 0"
    },
    "pendingCardSelections": {
      "playerId_2_setPower_1753090836037": {
        "playerId": "playerId_2",
        "eligibleCards": [
          {
            "cardId": "c-1",
            "zone": "left",
            "name": "總統特朗普",
            "cardType": "character",
            "power": 100
          },
          {
            "cardId": "c-10",
            "zone": "left",
            "name": "爱德华·科林斯汀 Edward Coristine (Doge 六子）",
            "cardType": "character",
            "gameType": "愛國者",
            "power": 40
          },
          {
            "cardId": "c-10",
            "zone": "left",
            "name": "爱德华·科林斯汀 Edward Coristine (Doge 六子）",
            "cardType": "character",
            "gameType": "愛國者",
            "power": 40
          },
          {
            "cardId": "c-10",
            "zone": "left",
            "name": "爱德华·科林斯汀 Edward Coristine (Doge 六子）",
            "cardType": "character",
            "gameType": "愛國者",
            "power": 40
          },
          {
            "cardId": "c-10",
            "zone": "left",
            "name": "爱德华·科林斯汀 Edward Coristine (Doge 六子）",
            "cardType": "character",
            "gameType": "愛國者",
            "power": 40
          },
          {
            "cardId": "c-10",
            "zone": "left",
            "name": "爱德华·科林斯汀 Edward Coristine (Doge 六子）",
            "cardType": "character",
            "gameType": "愛國者",
            "power": 40
          },
          {
            "cardId": "c-10",
            "zone": "left",
            "name": "爱德华·科林斯汀 Edward Coristine (Doge 六子）",
            "cardType": "character",
            "gameType": "愛國者",
            "power": 40
          },
          {
            "cardId": "c-10",
            "zone": "left",
            "name": "爱德华·科林斯汀 Edward Coristine (Doge 六子）",
            "cardType": "character",
            "gameType": "愛國者",
            "power": 40
          }
        ],
        "selectCount": 1,
        "effect": {
          "type": "setPower",
          "value": 0
        },
        "effectType": "setPower",
        "targetPlayerId": "playerId_1",
        "timestamp": 1753090836037
      }
    },
    "playSequence": {
      "globalSequence": 4,
      "plays": [
        {
          "sequenceId": 1,
          "playerId": "playerId_1",
          "cardId": "s-1",
          "action": "PLAY_LEADER",
          "zone": "leader",
          "data": {
            "leaderIndex": 0,
            "isInjectedState": true
          },
          "timestamp": "2025-07-21T09:38:46.336Z",
          "turnNumber": 0,
          "phaseWhenPlayed": "MAIN_PHASE"
        },
        {
          "sequenceId": 2,
          "playerId": "playerId_2",
          "cardId": "s-2",
          "action": "PLAY_LEADER",
          "zone": "leader",
          "data": {
            "leaderIndex": 0,
            "isInjectedState": true
          },
          "timestamp": "2025-07-21T09:38:46.337Z",
          "turnNumber": 0,
          "phaseWhenPlayed": "MAIN_PHASE"
        },
        {
          "sequenceId": 3,
          "playerId": "playerId_1",
          "cardId": "c-1",
          "action": "PLAY_CARD",
          "zone": "left",
          "data": {
            "isFaceDown": false,
            "cardIndex": 0,
            "fieldIndex": 1
          },
          "timestamp": "2025-07-21T09:38:51.346Z",
          "turnNumber": 0,
          "phaseWhenPlayed": "MAIN_PHASE"
        },
        {
          "sequenceId": 4,
          "playerId": "playerId_2",
          "cardId": "h-2",
          "action": "PLAY_CARD",
          "zone": "help",
          "data": {
            "isFaceDown": false,
            "cardIndex": 0,
            "fieldIndex": 3
          },
          "timestamp": "2025-07-21T09:40:36.037Z",
          "turnNumber": 1,
          "phaseWhenPlayed": "MAIN_PHASE"
        }
      ]
    }
  },

  "playerActions": [
    {
      "step": 1,
      "playerId": "playerId_2",
      "description": "Player 2 selects c-1 with h-2's setPower effect",
      "action": {
        "actionType": "SelectCard",
        "selectionId": "playerId_2_setPower_1753090836037",
        "cardIds": ["c-1"]
      },
      "expectedResult": {
        "success": true,
        "message": "Card selection completed successfully"
      }
    }
  ],

  "expectedStateChanges": {
    "players.playerId_1.fieldEffects.activeEffects.length": 4,
    "zones.playerId_1.left.0.valueOnField": 0,
    "players.playerId_1.fieldEffects.calculatedPowers.c-1": 0,
    "playSequence.plays.length": 5,
    "players.playerId_1.playerPoint": 0
  },

  "validationPoints": [
    {
      "cardId": "c-1",
      "zone": "left",
      "playerId": "playerId_1",
      "description": "c-1 power should be set to 0 by h-2's setPower effect",
      "expectedPower": 0,
      "powerSource": "h-2 setPower effect overrides all other effects including leader boost (+45) and character boost (+10)"
    }
  ],

  "activeEffectsValidation": {
    "playerId_1": {
      "requiredEffects": [
        {
          "source": "s-1",
          "type": "powerBoost",
          "target": {
            "scope": "SELF",
            "gameTypes": ["右翼", "愛國者"]
          },
          "value": 45,
          "description": "Trump leader power boost for 右翼/愛國者 cards"
        },
        {
          "source": "s-1",
          "type": "setPower",
          "target": {
            "scope": "SELF",
            "gameTypes": ["經濟"]
          },
          "value": 0,
          "description": "Trump vs Powell conditional economic card nerf"
        },
        {
          "source": "c-1",
          "type": "powerBoost",
          "target": {
            "scope": "SELF",
            "traits": ["特朗普家族"]
          },
          "value": 10,
          "description": "c-1 character effect boosting Trump family cards"
        },
        {
          "source": "h-2",
          "type": "setPower",
          "target": {
            "scope": "OPPONENT",
            "specificCards": ["c-1"]
          },
          "value": 0,
          "description": "h-2's MAGA effect setting c-1 power to 0 (NEW - should be added)"
        }
      ],
      "totalEffectsCount": 4
    }
  },

  "playSequenceValidation": {
    "expectedPlays": 5,
    "newPlayValidation": {
      "type": "APPLY_SET_POWER",
      "playerId": "playerId_2",
      "targetPlayerId": "playerId_1",
      "sourceCard": "h-2",
      "selectedCardIds": ["c-1"],
      "powerValue": 0,
      "description": "setPower effect recorded in play sequence for replay consistency"
    }
  },

  "cardDefinitions": {
    "c-1": {
      "id": "c-1",
      "name": "總統特朗普",
      "cardType": "character",
      "gameType": "愛國者",
      "power": 100,
      "traits": ["特朗普家族"],
      "rarity": "legendary"
    },
    "h-2": {
      "id": "h-2",
      "name": "Make America Great Again",
      "cardType": "help",
      "effects": {
        "description": "選擇對方一張角色卡，原能力值 變成 0",
        "rules": [
          {
            "id": "maga_nerf",
            "type": "triggered",
            "trigger": {
              "event": "onPlay",
              "conditions": []
            },
            "target": {
              "owner": "opponent",
              "zones": ["top", "left", "right"],
              "requiresSelection": true,
              "selectCount": 1,
              "filters": []
            },
            "effect": {
              "type": "setPower",
              "value": 0
            }
          }
        ]
      }
    },
    "s-1": {
      "id": "s-1", 
      "name": "特朗普",
      "cardType": "leader",
      "gameType": "右翼",
      "initialPoint": 110,
      "level": 7,
      "rarity": "legendary",
      "zoneCompatibility": {
        "top": ["右翼", "自由", "經濟"],
        "left": ["右翼", "自由", "愛國者"],
        "right": ["右翼", "愛國者", "經濟"]
      }
    },
    "s-2": {
      "id": "s-2",
      "name": "拜登", 
      "cardType": "leader",
      "gameType": "左翼",
      "initialPoint": 100,
      "level": 7,
      "rarity": "legendary",
      "zoneCompatibility": {
        "top": ["左翼", "自由", "經濟", "右翼", "愛國者"],
        "left": ["左翼", "自由", "經濟", "右翼", "愛國者"],
        "right": ["左翼", "自由", "經濟", "右翼", "愛國者"]
      }
    }
  },

  "testNotes": {
    "purpose": "Validate h-2 Make America Great Again setPower effect with fixed implementation",
    "basedOnRealGameState": "Created from actual user game environment with pending card selection",
    "keyValidations": [
      "Card selection workflow completion",
      "setPower effect properly recorded in activeEffects",
      "setPower effect added to playSequence for replay consistency",
      "Power display synchronization (valueOnField = 0)",
      "Effect overrides multiple existing power modifiers",
      "Cross-player effect targeting with specificCards",
      "Turn progression after card selection"
    ],
    "powerCalculationFlow": {
      "before": {
        "basePower": 100,
        "trumpLeaderBoost": 45,
        "characterBoost": 10,
        "total": 155,
        "note": "c-1 benefits from both leader and character power boosts"
      },
      "after": {
        "setPowerEffect": 0,
        "note": "setPower effect overrides ALL other modifiers (priority)",
        "total": 0
      }
    },
    "architecturalFixes": {
      "playSequenceIntegration": "setPower effects now recorded as APPLY_SET_POWER actions",
      "effectSimulatorSupport": "Added APPLY_SET_POWER case to executePlayUnified method",
      "replayConsistency": "Effects survive simulateCardPlaySequence calls",
      "displaySynchronization": "valueOnField updated to match calculated power"
    },
    "testCoverage": {
      "cardSelectionWorkflow": "Complete selection from trigger to completion",
      "effectPersistence": "Effects survive turn switching and replay",
      "crossPlayerEffects": "Effect stored in target player's activeEffects",
      "prioritySystem": "setPower overrides powerBoost effects",
      "gameStateIntegrity": "All game state properly updated post-selection"
    },
    "realWorldScenario": "Based on user's actual game where c-1 power wasn't updating to 0 after h-2 selection"
  }
}